<?php
global $semaphore;

include_once 'common.php';

function lib_validate_bisca($card) {
  global $color;
  switch ($card) {
    case 2: $color = COLOR1; break;
    case 3: $color = COLOR2; break;
    default: $color = COLOR4;
  }
  return ($card >= 1) && ($card <= 3);
}

function lib_comment_bisca($card = 1) {
  echo "Bisca style backs, card {$card}.";
}

function lib_style_bisca($card = 1) {
  global $color;
?>
  .cf0 { fill: <?= $color ?>; }
  .cs0, .cs1 { stroke: <?= $color ?>; }
<?php
}

function lib_defs_bisca($card = 1) {
?>
  <g id="l" transform="translate(276, 100)">
    <!-- Bisca Ambigram -->
    <path d="M249.50025,0 C250.16725,18 250.16725,36 249.50025,54 C244.23925,78.414 229.07225,91.914 204.00025,94.5 C169.33525,95 134.66825,95.167 100.00025,95 L100.00025,145 L100.00025,145 C128.57225,143.652 145.40625,128.985 150.50025,101 C153.26525,125.078 166.43225,139.578 190.00025,144.5 C215.96125,147.873 227.12725,136.706 223.50025,111 C221.40325,104.943 217.57025,100.443 212.00025,97.5 C230.76625,100.817 242.93325,111.65 248.50025,130 C254.63025,169.688 237.79625,191.354 198.00025,195 C178.52125,193.693 164.02125,184.693 154.50025,168 C152.70325,163.477 151.53625,158.81 151.00025,154 C151.18825,152.397 150.68825,151.063 149.50025,150 C149.03625,150.594 148.86925,151.261 149.00025,152 C145.96725,175.921 132.63425,190.088 109.00025,194.5 L37.00025,195.5 L37.00025,195.5 C26.41925,196.249 16.75225,199.582 8.00025,205.5 C4.88625,208.56 2.38625,212.06 0.50025,216 C-0.16675,173 -0.16675,130 0.50025,87 C4.32725,64.117 17.49425,50.284 40.00025,45.5 L210.00025,44.5 L210.00025,44.5 C233.87425,39.295 247.04125,24.461 249.50025,0 Z M75.00025,95 L43.00025,95 C29.76325,100.45 23.93025,110.45 25.50025,125 C27.32425,135.176 33.15725,141.676 43.00025,144.5 C53.66125,145 64.32825,145.167 75.00025,145 L75.00025,145 L75.00025,95 L75.00025,95 Z" />
    <path d="M151.00025,154 C150.33325,153.333 149.66725,152.667 149.00025,152 C148.86925,151.261 149.03625,150.594 149.50025,150 C150.68825,151.063 151.18825,152.397 151.00025,154 Z" />
    <path d="M199.00025,200 C200.16225,217.829 200.32925,235.829 199.50025,254 C194.23925,278.414 179.07225,291.914 154.00025,294.5 C127.66925,295 101.33525,295.167 75.00025,295 C75.00025,278.333 75.00025,261.667 75.00025,245 C103.33525,245.167 131.66925,245 160.00025,244.5 C184.01025,239.311 197.01025,224.478 199.00025,200 Z" />
    <path d="M40.00025,245 C43.33325,245 46.66725,245 50.00025,245 C50.00025,261.667 50.00025,278.333 50.00025,295 C28.27725,298.419 20.77725,310.753 27.50025,332 C31.22125,338.372 36.72125,342.539 44.00025,344.5 C70.99825,345 97.99825,345.167 125.00025,345 C125.47325,332.703 131.47325,324.537 143.00025,320.5 C155.00025,319.833 167.00025,319.833 179.00025,320.5 C189.24425,322.416 196.07825,328.249 199.50025,338 C200.16725,358.333 200.16725,378.667 199.50025,399 C196.83325,412.417 188.66625,419.417 175.00025,420 C175.16725,401.997 175.00025,383.997 174.50025,366 C170.91225,357.293 164.74525,354.793 156.00025,358.5 C154.50025,360 153.00025,361.5 151.50025,363 C150.74825,370.676 148.74825,378.009 145.50025,385 C141.84825,390.579 136.68225,393.745 130.00025,394.5 C100.66725,395.167 71.33325,395.167 42.00025,394.5 C18.55725,390.719 4.72425,377.219 0.50025,354 C-0.16675,331.667 -0.16675,309.333 0.50025,287 C4.42925,264.037 17.59525,250.037 40.00025,245 Z" />
    <path d="M244.00025,245 C265.01025,244.178 275.17725,254.178 274.50025,275 C269.84825,289.966 259.68125,296.466 244.00025,294.5 C229.60225,289.416 223.43525,279.249 225.50025,264 C228.51725,254.484 234.68425,248.151 244.00025,245 Z" />
  </g>
<?php
  $k = 5;
  srand(456 + ($card - 1)); // always use the same random seed
  print('<g id="b" stroke="none" class="cf0">');
  for ($i = 0; $i < ((CARD_CUT_LINE_W/$k)/2); $i++) {
    for ($j = 0; $j < ((CARD_CUT_LINE_H/$k)/2); $j++) {
      if (rand(0, 1) !== 0) {
        printf('<rect x="%s" y="%s" width="%s" height="%s" />',
          ($i * $k), ($j * $k), $k, $k );
      }
    }
  }
  print('</g>' . PHP_EOL);
}

function quadrant_ea_bisca($quad, $card) {
  echo "<!-- Quadrant {$quad} ({$card}) -->";
  echo '<use href="#b" />';
}

function quadrant_1_bisca($card = 1) { quadrant_ea_bisca(1, $card); }
function quadrant_2_bisca($card = 1) { quadrant_ea_bisca(2, $card); }
function quadrant_3_bisca($card = 1) { quadrant_ea_bisca(3, $card); }
function quadrant_4_bisca($card = 1) { quadrant_ea_bisca(4, $card); }

function half_ea_bisca($half, $card) {
  global $color;
  print("    <!-- Half {$half} ({$card}) -->") . PHP_EOL;
  printf('    <g stroke="#FFF" stroke-width="9" fill="%s"><use href="#l" /></g>' . PHP_EOL,
    $color . '7F' );
}

function half_1_bisca($card = 1) { half_ea_bisca(1, $card); }
function half_2_bisca($card = 1) { half_ea_bisca(2, $card); }
